swimmers = [
    {"Swimmer": "Nicole Allen", "Age": 24, "Gender": "W", "Fly50": 35.04, "Back50": 39.91, "Breast50": 40.04, "Free50": 30.12},
    {"Swimmer": "Paul Ames", "Age": 56, "Gender": "M", "Fly50": 35.31, "Back50": 37.96, "Breast50": 38.15, "Free50": 30.93},
    {"Swimmer": "Alex Baird", "Age": 29, "Gender": "M", "Fly50": 28.35, "Back50": 30.44, "Breast50": 38.5,  "Free50": 26.43},
    # {"Swimmer": "Graeme Bennett", "Age": 66, "Gender": "M", "Fly50": 999.99, "Back50": 999.99, "Breast50": 47.19, "Free50": 37.5},
    # {"Swimmer": "Amy Carlin", "Age": 46, "Gender": "W", "Fly50": 999.99, "Back50": 60.22, "Breast50": 61.53, "Free50": 47.19},
    # {"Swimmer": "Adam Comer", "Age": 24, "Gender": "M", "Fly50": 31.85, "Back50": 34,    "Breast50": 37.47, "Free50": 27.53},
    # {"Swimmer": "Rob Corne", "Age": 68, "Gender": "M", "Fly50": 48.22, "Back50": 50.34, "Breast50": 50.22, "Free50": 45},
    # {"Swimmer": "Michael Dai", "Age": 33, "Gender": "M", "Fly50": 28.0, "Back50": 29.0, "Breast50": 999.99, "Free50": 27.0},
    {"Swimmer": "Fayth Doherty", "Age": 24, "Gender": "W", "Fly50": 37.21, "Back50": 40,    "Breast50": 50,    "Free50": 32.0},
    {"Swimmer": "Brent Foster", "Age": 58, "Gender": "M", "Fly50": 30.0, "Back50": 32,    "Breast50": 35,    "Free50": 28.0}
    {"Swimmer": "David Gribble", "Age": 48, "Gender": "M", "Fly50": 31.23, "Back50": 999.99, "Breast50": 36,    "Free50": 28.74},
    # {"Swimmer": "Lucy Hannah", "Age": 55, "Gender": "W", "Fly50": 999.99, "Back50": 999.99, "Breast50": 999.99, "Free50": 46.00},
    {"Swimmer": "Lucy Happe", "Age": 28, "Gender": "W", "Fly50": 35.5,  "Back50": 36.52, "Breast50": 999.99, "Free50": 29.38},
    {"Swimmer": "Thomas James","Age": 34, "Gender": "M", "Fly50": 28.92, "Back50": 31.6,  "Breast50": 999.99, "Free50": 27.9},
    # {"Swimmer": "Graham Leach","Age": 89, "Gender": "M", "Fly50": 55,    "Back50": 999.99, "Breast50": 999.99, "Free50": 43.88},
    {"Swimmer": "Hong Lee",   "Age": 42, "Gender": "M", "Fly50": 999.99, "Back50": 999.99, "Breast50": 42.12, "Free50": 39},
    {"Swimmer": "Michelle Lockhart","Age": 64, "Gender": "W", "Fly50": 40.5,  "Back50": 46,    "Breast50": 47.28, "Free50": 35},
    {"Swimmer": "Eugene Manko","Age": 58, "Gender": "M", "Fly50": 31.7,  "Back50": 34,    "Breast50": 36.46, "Free50": 28.27},
    # {"Swimmer": "Brenda Martin","Age": 56, "Gender": "W", "Fly50": 999.99, "Back50": 999.99, "Breast50": 999.99, "Free50": 50.00},
    # {"Swimmer": "Graeme Martin","Age": 60, "Gender": "M", "Fly50": 999.99, "Back50": 999.99, "Breast50": 999.99, "Free50": 41.00},
    {"Swimmer": "David Misslebrook","Age": 62, "Gender": "M", "Fly50": 999.99, "Back50": 999.99, "Breast50": 39.00, "Free50": 999.99},
    {"Swimmer": "Barrett Quinn","Age": 52, "Gender": "M", "Fly50": 36.00, "Back50": 38.00, "Breast50": 40.99, "Free50": 32.00},
    # {"Swimmer": "Ash Raja",    "Age": 59, "Gender": "M", "Fly50": 34.8,  "Back50": 37.81, "Breast50": 41.44, "Free50": 35},
    {"Swimmer": "Tayla Ranger","Age": 24, "Gender": "W", "Fly50": 999.99, "Back50": 41.52, "Breast50": 49.92, "Free50": 38.49},
    # {"Swimmer": "Ann Rogerson","Age": 70, "Gender": "W", "Fly50": 999.99, "Back50": 999.99, "Breast50": 999.99, "Free50": 50},
    {"Swimmer": "Shelley Rowland","Age": 54, "Gender": "W", "Fly50": 32.19, "Back50": 36.47, "Breast50": 44,    "Free50": 31.22},
    # {"Swimmer": "Reuben Schuitemaker","Age": 29, "Gender": "M", "Fly50": 36.21, "Back50": 38,    "Breast50": 999.99, "Free50": 30.35},
    {"Swimmer": "Kyla Steenhart","Age": 47, "Gender": "W", "Fly50": 999.99, "Back50": 40.02, "Breast50": 35.82, "Free50": 30.25},
    # {"Swimmer": "Clarence Tai","Age": 30, "Gender": "M", "Fly50": 34.75, "Back50": 999.99, "Breast50": 41,    "Free50": 31.25},
    {"Swimmer": "Jeremiah Teo","Age": 31, "Gender": "M", "Fly50": 33,    "Back50": 36.5,  "Breast50": 33.78,  "Free50": 29},
    {"Swimmer": "Marcus Thieme","Age": 45, "Gender": "M", "Fly50": 32.86, "Back50": 33.86, "Breast50": 39.43, "Free50": 28.13},
    # {"Swimmer": "Edwin Tsang","Age": 30, "Gender": "M", "Fly50": 32.5,  "Back50": 34,    "Breast50": 999.99, "Free50": 29},
    {"Swimmer": "Nina Veal",  "Age": 52, "Gender": "W", "Fly50": 37.5,  "Back50": 41.88, "Breast50": 40.88, "Free50": 32.5},
    # {"Swimmer": "Penelope Virtosu","Age": 32, "Gender": "W", "Fly50": 999.99, "Back50": 999.99, "Breast50": 999.99, "Free50": 999.99},
    {"Swimmer": "Henry Wiseman","Age": 29, "Gender": "M", "Fly50": 29.37, "Back50": 31.96, "Breast50": 34.74, "Free50": 26},
    {"Swimmer": "Honglei Zhang","Age": 46, "Gender": "M", "Fly50": 51.15, "Back50": 50.03, "Breast50": 43.97, "Free50": 34.25}
]


def swimmer_to_string(swim_obj, stroke = None) -> str:
    if stroke is None:
        return (f"{swim_obj['Swimmer']} | Age: {swim_obj['Age']} | Gender: {swim_obj['Gender']} | "
            f"Times: Fly = {swim_obj['Fly50']}s, Back = {swim_obj['Back50']}s, "
            f"Breast = {swim_obj['Breast50']}s, Free = {swim_obj['Free50']}s.")
    else:
        stroke_mapping = {"Fly": swim_obj['Fly50'], "Back": swim_obj['Back50'], "Breast": swim_obj['Breast50'], "Free": swim_obj['Free50']}
        return (f"{swim_obj['Swimmer']} | Age: {swim_obj['Age']} | Gender: {swim_obj['Gender']} | "
                f"Time = {stroke_mapping[stroke]}s.")


def log_swimmer_object(swim_obj):
    print(f"{swim_obj['Swimmer']} | Age: {swim_obj['Age']} | Gender: {swim_obj['Gender']} | "
          f"Times: Fly = {swim_obj['Fly50']}s, Back = {swim_obj['Back50']}s, "
          f"Breast = {swim_obj['Breast50']}s, Free = {swim_obj['Free50']}s.")


def log_relay(relay_team):
    total = 0
    for i, (stroke, key) in enumerate([('Back','Back50'), ('Breast','Breast50'), ('Fly','Fly50'), ('Free','Free50')], start=1):
        s = relay_team[stroke]
        print(f"{i}. {stroke}: {s['Swimmer']} | Age: {s['Age']} | Gender: {s['Gender']} | Time: {s[key]}s")
        total += s[key]
    minutes = int(total // 60)
    seconds = total % 60
    print(f"Estimated time: {minutes}:{seconds:.2f}\n")


def log_monahan(relay_arr):
    total = 0
    for idx, s in enumerate(relay_arr, start=1):
        print(f"{idx}. {s['Swimmer']} | Age: {s['Age']} | Gender: {s['Gender']} | Time: {s['Free50']}s")
        total += s['Free50']
    minutes = int(total // 60)
    seconds = total % 60
    print(f"Estimated time: {minutes}:{seconds:.2f}\n")


def log_stewart(relay_arr):
    total = 0
    for idx, s in enumerate(relay_arr, start=1):
        print(f"{idx}. {s['Swimmer']} | Age: {s['Age']} | Gender: {s['Gender']} | Time: {s['Fly50']}s")
        total += s['Fly50']
    minutes = int(total // 60)
    seconds = total % 60
    print(f"Estimated time: {minutes}:{seconds:.2f}\n")


def get_n_fastest(n, stroke, gender, pool=None):
    if pool is None:
        pool = swimmers
    key = f"{stroke}50"
    filtered = [s for s in pool if s['Gender'] == gender and key in s]
    sorted_swimmers = sorted(filtered, key=lambda x: x[key])
    return sorted_swimmers[:n]


def optimal_stewart(pool=None):
    if pool is None:
        pool = swimmers
    men = get_n_fastest(3, 'Fly', 'M', pool)
    women = get_n_fastest(3, 'Fly', 'W', pool)
    return men + women


def optimal_monahan(pool=None, required_age: int = 200):
    if pool is None:
        pool = swimmers
    men = [s for s in pool if s['Gender'] == 'M']
    women = [s for s in pool if s['Gender'] == 'W']
    best = {'team': None, 'time': float('inf')}
    for i in range(len(men)):
        for j in range(i+1, len(men)):
            for k in range(len(women)):
                for l in range(k+1, len(women)):
                    team = [men[i], men[j], women[k], women[l]]
                    age_sum = sum(s['Age'] for s in team)
                    if age_sum < required_age:
                        continue
                    time_sum = sum(s['Free50'] for s in team)
                    if time_sum < best['time']:
                        best = {'team': team, 'time': time_sum}
    return best['team']


def optimal_medley(gender, pool=None):
    if pool is None:
        pool = swimmers
    if not gender == 'X': # NEW: X stands for mixed gender
        roster = [s for s in pool if s['Gender'] == gender]
    best = {'combo': None, 'time': float('inf')}
    for b in roster:
        for br in roster:
            if br is b: continue
            for f in roster:
                if f is b or f is br: continue
                for fr in roster:
                    if fr is b or fr is br or fr is f: continue
                    time_sum = b['Back50'] + br['Breast50'] + f['Fly50'] + fr['Free50']
                    if time_sum < best['time']:
                        best = {'combo': {'Back': b, 'Breast': br, 'Fly': f, 'Free': fr}, 'time': time_sum}
    return best['combo']


def pick_best(relay_fn, pool):
    raw = relay_fn(pool)
    arr = list(raw.values()) if isinstance(raw, dict) else raw
    return {'raw': raw, 'arr': arr}


def pick_abc(relay_fn, label, roster, num_teams = 3):
    teams = ['A', 'B', 'C']
    if num_teams > 3:
        print("[ERROR]: More than 3 teams requested exceeding max limit.")
    elif num_teams < 3:
        diff = -(3-num_teams)
        teams = teams[:diff]
    pool = roster.copy()
    print(f"\n{label} Relay Teams:\n" + "-"*42)
    for sq in teams:
        result = pick_best(relay_fn, pool)
        raw, arr = result['raw'], result['arr']
        print(f"{label} Team {sq}:")
        if label == 'Ted Stewart':
            log_stewart(arr)
        elif label == 'Joan Monahan':
            log_monahan(arr)
        else:
            log_relay(raw)
        names = {s['Swimmer'] for s in arr}
        pool = [s for s in pool if s['Swimmer'] not in names]


if __name__ == "__main__":
    # pick_abc(optimal_stewart, 'Ted Stewart', swimmers, 2)
    # pick_abc(lambda p: optimal_monahan(p, 0), 'Joan Monahan', swimmers, 2)
    pick_abc(lambda p: optimal_medley('M', p), "Men's Medley", swimmers, 3)
    pick_abc(lambda p: optimal_medley('W', p), "Women's Medley", swimmers, 2)
    # print()
    stroke = 'Free'
    gender = 'W'
    n_fastest = (get_n_fastest(13, stroke, 'W'))
    for i in range(len(n_fastest)):
        print(f"{i+1}: {swimmer_to_string(n_fastest[i], stroke)}")
    n_fastest = (get_n_fastest(13, stroke, 'M'))
    for i in range(len(n_fastest)):
        print(f"{i+1}: {swimmer_to_string(n_fastest[i], stroke)}")